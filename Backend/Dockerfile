

FROM node:22.17.1-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# Build stage
ARG BASE_URL
ARG FRONT_URL

ARG PG_PORT
ARG PORT_SERVER
ARG PG_NAME
ARG PG_PASSWORD
ARG DB_NAME

ARG JWT_KEY

ARG OUR_MAIL
ARG MAIL_PASSWORD
ARG MAIL_HOST

ARG CLOUD_NAME
ARG CLOUD_API_KEY
ARG CLOUD_API_SECRET

ARG STRIPE_SECRET_KEY
ARG STRIPE_WEBHOOK_SECRET
ARG CLIENT_URL
ARG CLIENT_CART_URL

ENV BASE_URL=${BASE_URL}
ENV FRONT_URL=${FRONT_URL}

ENV PG_PORT=${PG_PORT}
ENV PORT_SERVER=${PORT_SERVER}
ENV PG_NAME=${PG_NAME}
ENV PG_PASSWORD=${PG_PASSWORD}
ENV DB_NAME=${DB_NAME}

ENV JWT_KEY=${JWT_KEY}

ENV OUR_MAIL=${OUR_MAIL}
ENV MAIL_PASSWORD=${MAIL_PASSWORD}
ENV MAIL_HOST=${MAIL_HOST}

ENV CLOUD_NAME=${CLOUD_NAME}
ENV CLOUD_API_KEY=${CLOUD_API_KEY}
ENV CLOUD_API_SECRET=${CLOUD_API_SECRET}

ENV STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
ENV STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET}
ENV CLIENT_URL=${CLIENT_URL}
ENV CLIENT_CART_URL=${CLIENT_CART_URL}


EXPOSE 4000
CMD ["node", "./dist/src/index.js"]